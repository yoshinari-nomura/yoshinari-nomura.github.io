<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:02258] Re: gemcal on gtk2 -->
<!--X-From-R13: Fngfhln Yvabfuvgn <gngfNirtn.bpa.ar.wc> -->
<!--X-Date: Fri, 26 Jan 2007 02:06:03 +0900 (JST) -->
<!--X-Message-Id: 20070126.020603.109396989.tats%nobody@tats.iris.ne.jp -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20061213141142R.nom@oasis.swlab.it.okayama&#45;u.ac.jp -->
<!--X-Reference: 20061214.004223.21988976.tats%nobody@tats.iris.ne.jp -->
<!--X-Reference: 20061218184231G.nom@oasis.swlab.it.okayama&#45;u.ac.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:02258] Re: gemcal on gtk2</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg02256.html">Date Prev</a>][<a href="msg02258.html">Date Next</a>][<a href="msg02240.html">Thread Prev</a>][<a href="msg02259.html">Thread Next</a>][<a href="maillist.html#02257">Date Index</a>][<a href="threads.html#02257">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:02258] Re: gemcal on gtk2</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:02258] Re: gemcal on gtk2</li>
<li><em>From</em>: Tatsuya Kinoshita &lt;<a href="mailto:tats@DOMAIN.HIDDEN">tats@xxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Fri, 26 Jan 2007 02:06:03 +0900 (JST)</li>
<li><em>Delivered-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:20061218184231G.nom@DOMAIN.HIDDEN">20061218184231G.nom@xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:mhc-ctl@quickhack.net?body=help">mailto:mhc-ctl@quickhack.net?body=help</a>&gt;</li>
<li><em>List-id</em>: mhc.quickhack.net</li>
<li><em>List-owner</em>: &lt;<a href="mailto:mhc-admin@quickhack.net">mailto:mhc-admin@quickhack.net</a>&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:mhc@quickhack.net">mailto:mhc@quickhack.net</a>&gt;</li>
<li><em>List-software</em>: fml [fml 4.0.3 release (20011202/4.0.3)]</li>
<li><em>List-unsubscribe</em>: &lt;<a href="mailto:mhc-ctl@quickhack.net?body=unsubscribe">mailto:mhc-ctl@quickhack.net?body=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:20061213141142R.nom@DOMAIN.HIDDEN">20061213141142R.nom@xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20061214.004223.21988976.tats%25nobody@DOMAIN.HIDDEN">20061214.004223.21988976.tats%nobody@xxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20061218184231G.nom@DOMAIN.HIDDEN">20061218184231G.nom@xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On December 18, 2006, [mhc:02240],
nom (at quickhack.net) wrote:

&gt; mhc-kconv &#x306E;&#x30D1;&#x30C3;&#x30C1;&#x3092;&#x53D6;&#x308A;&#x8FBC;&#x3093;&#x3060;&#x306E;&#x3067;&#xFF0C;today &#x306E;&#x753B;&#x9762;&#x8868;&#x793A;&#x304C;
&gt; &#x74B0;&#x5883;&#x306B;&#x95A2;&#x308F;&#x3089;&#x305A; UTF-8 &#x306B;&#x306A;&#x3063;&#x3066;&#x3057;&#x307E;&#x3063;&#x3066;&#x3044;&#x307E;&#x3059;&#xFF0E;

mhc-gtk&#x3067;&#x306F;UTF-8&#x56FA;&#x5B9A;&#x306B;&#x3057;&#x3064;&#x3064;&#x3001;&#x307B;&#x304B;&#x3067;&#x306F;locale&#x306B;&#x5FDC;&#x3058;&#x305F;&#x8868;&#x793A;&#x306B;&#x306A;&#x308B;&#x3068;&#x3044;&#x3044;
&#x306E;&#x3067;&#x3057;&#x3087;&#x3046;&#x306D;&#x3002;&#x4E0B;&#x8A18;&#x306E;&#x30D1;&#x30C3;&#x30C1;&#x3067;eucJP, SJIS, UTF-8 locale&#x306B;&#x5BFE;&#x5FDC;&#x3067;&#x304D;&#x308B;&#x3082;&#x306E;
&#x3068;&#x601D;&#x3044;&#x307E;&#x3059;&#x3002;&#x3044;&#x304B;&#x304C;&#x3067;&#x3057;&#x3087;&#x3046;&#x304B;&#x3002;

(mhc-gtk&#x3067;MhcKconv::todisp&#x3092;&#x518D;&#x5B9A;&#x7FA9;&#x3059;&#x308B;&#x306E;&#x3067;&#x306F;&#x306A;&#x304F;&#x3001;mhc-gtk&#x5C02;&#x7528;&#x306B;&#x5225;&#x306E;
&#x95A2;&#x6570;&#x3092;&#x7528;&#x610F;&#x3059;&#x308B;&#x65B9;&#x304C;&#x3044;&#x3044;&#x306E;&#x304B;&#x3082;&#x3057;&#x308C;&#x307E;&#x305B;&#x3093;&#x304C;&#x3001;&#x3068;&#x308A;&#x3042;&#x3048;&#x305A;&#x3001;&#x5143;&#x306E;&#x30B3;&#x30FC;&#x30C9;&#x306B;
&#x6CBF;&#x3063;&#x305F;&#x5F62;&#x306B;&#x3057;&#x3066;&#x307F;&#x307E;&#x3057;&#x305F;)

----
--- mhc.orig/ruby-ext/lib/mhc-gtk.rb.in
+++ mhc/ruby-ext/lib/mhc-gtk.rb.in
@@ -17,13 +17,10 @@
 require 'mhc-signal'
 
 module MhcKconv
-  if RUBY_PLATFORM =~ /mswin32|cygwin|mingw/
-    require 'uconv'
-    def todisp(string)
-      Uconv::euctou8(Kconv::toeuc(string))
-    end
-    module_function :todisp
+  def todisp(string)
+    Kconv::kconv(string, Kconv::UTF8, Kconv::AUTO)
   end
+  module_function :todisp
 end
 
 Gtk.init
--- mhc.orig/ruby-ext/lib/mhc-kconv.rb
+++ mhc/ruby-ext/lib/mhc-kconv.rb
@@ -9,7 +9,14 @@
 require 'kconv'
 
 module MhcKconv
-  DISP_CODE = Kconv::UTF8
+  env = ENV['LC_ALL'] || ENV['LC_CTYPE'] || ENV['LANG']
+  if env =~ /euc/i
+    DISP_CODE = Kconv::EUC
+  elsif env =~ /sjis|shift_jis/i
+    DISP_CODE = Kconv::SJIS
+  else
+    DISP_CODE = Kconv::UTF8
+  end
 
   def todisp(string)
     Kconv::kconv(string, DISP_CODE, Kconv::AUTO)
----

-- 
&#x6728;&#x4E0B;&#x9054;&#x4E5F;
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="02259" href="msg02259.html">[mhc:02260] Re: gemcal on gtk2</a></strong>
<ul><li><em>From:</em> Yoshinari Nomura</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="02237" href="msg02237.html">[mhc:02238] Re: gemcal on gtk2</a></strong>
<ul><li><em>From:</em> nom</li></ul></li>
<li><strong><a name="02238" href="msg02238.html">[mhc:02239] Re: gemcal on gtk2</a></strong>
<ul><li><em>From:</em> Tatsuya Kinoshita</li></ul></li>
<li><strong><a name="02239" href="msg02239.html">[mhc:02240] Re: gemcal on gtk2</a></strong>
<ul><li><em>From:</em> nom</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg02256.html">[mhc:02257] Re: &#x4E88;&#x5B9A;&#x8868;&#x306E;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x306B;&#x3064;&#x3044;&#x3066;</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg02258.html">[mhc:02259] Re: &#x4E88;&#x5B9A;&#x8868;&#x306E;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x306B;&#x3064;&#x3044;&#x3066;</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg02240.html">[mhc:02241] Re: gemcal on gtk2</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg02259.html">[mhc:02260] Re: gemcal on gtk2</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#02257"><strong>Date</strong></a></li>
<li><a href="threads.html#02257"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
