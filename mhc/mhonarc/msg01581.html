<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:01582] Re: Palm -->
<!--X-From-R13: Oxven Thanunfuv <shanNshan.bet> -->
<!--X-Date: Wed, 19 Jun 2002 23:32:56 +0900 (JST) -->
<!--X-Message-Id: 20020619.233256.41630047.funa@funa.org -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 20020605.205151.76244832.non@nsknet.or.jp -->
<!--X-Reference: 20020606xjcofeou9rj.kose@casper.tamra.co.jp -->
<!--X-Reference: 20020606.170902.33106403.non@nsknet.or.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:01582] Re: Palm</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg01580.html">Date Prev</a>][<a href="msg01582.html">Date Next</a>][<a href="msg01568.html">Thread Prev</a>][<a href="msg01582.html">Thread Next</a>][<a href="maillist.html#01581">Date Index</a>][<a href="threads.html#01581">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:01582] Re: Palm</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:01582] Re: Palm</li>
<li><em>From</em>: Akira Funahashi &lt;<a href="mailto:funa@DOMAIN.HIDDEN">funa@xxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed, 19 Jun 2002 23:32:56 +0900 (JST)</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:20020606.170902.33106403.non@DOMAIN.HIDDEN">20020606.170902.33106403.non@xxxxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:20020605.205151.76244832.non@DOMAIN.HIDDEN">20020605.205151.76244832.non@xxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20020606xjcofeou9rj.kose@DOMAIN.HIDDEN">20020606xjcofeou9rj.kose@xxxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20020606.170902.33106403.non@DOMAIN.HIDDEN">20020606.170902.33106403.non@xxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&#x821F;&#x6A4B;&#x3068;&#x7533;&#x3057;&#x307E;&#x3059;&#x3002;

  Toyonobu Sawada &lt;non@xxxxxxxxxxxx&gt;
&#xFF0F;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;&#xFFE3;
&gt; &#x3053;&gt; &#x767D;&#x4E95;&#x3055;&#x3093;&#x306B; PEG-T650C
&gt; &#x3053;&gt; <a  rel="nofollow" href="http://www.jp.sonystyle.com/peg/Store/Clie/T650c/index.html">http://www.jp.sonystyle.com/peg/Store/Clie/T650c/index.html</a>
&gt; &#x3053;&gt; &#x3042;&#x305F;&#x308A;&#x3092;&#x8CB7;&#x3063;&#x3066;&#x3082;&#x3089;&#x3063;&#x3066;&#x8272;&#x3005;&#x3084;&#x3063;&#x3066;&#x3082;&#x3089;&#x3063;&#x3066;&#x3001;&#x3067;&#x304D;&#x305F;&#x7D50;&#x679C;&#x3092;&#x805E;&#x3053;&#x3046;&#x304B;&#x306A;&#x3002;:-)
&gt; &#x8CDB;&#x6210;!!

&#x6628;&#x65E5;&#x3001;CLIE PEG-T650C &#x3092;&#x5165;&#x624B;&#x3057;&#x305F;&#x306E;&#x3067; mhc2palm, palm2mhc&#x304C;
Linux(Vine-2.5)&#x4E0A;&#x3067;&#x52D5;&#x304B;&#x306A;&#x3044;&#x304B;&#x3001;&#x8A66;&#x884C;&#x932F;&#x8AA4;&#x3057;&#x3066;&#x307F;&#x307E;&#x3057;&#x305F;&#x3002;

&#x7D50;&#x8AD6;&#x304B;&#x3089;&#x8A00;&#x3044;&#x307E;&#x3059;&#x3068;&#x3001;CLIE &#x3067;&#x3082; USB &#x63A5;&#x7D9A;&#x3067; mhc2palm, palm2mhc &#x304C;&#x3067;&#x304D;&#x307E;&#x3057;&#x305F;&#x3002;
pilot-link-0.10.99 + mhc_pilib.c &#x3078;&#x306E; patch &#x3068;&#x3044;&#x3046;&#x7D44;&#x5408;&#x308F;&#x305B;&#x3067;&#x89E3;&#x6C7A;&#x3057;&#x307E;&#x3057;&#x305F;&#x3002;

CLIE &#x3067; pilot-link &#x3092;&#x4F7F;&#x3046;&#x65B9;&#x6CD5;&#x306F;
<a  rel="nofollow" href="http://browncat.org/palm/clie.html">http://browncat.org/palm/clie.html</a>
&#x304C;&#x975E;&#x5E38;&#x306B;&#x53C2;&#x8003;&#x306B;&#x306A;&#x308A;&#x307E;&#x3057;&#x305F;&#x3002;

&#x4E0A;&#x8A18;URL&#x306B;&#x8A18;&#x8FF0;&#x3055;&#x308C;&#x3066;&#x3044;&#x308B;&#x901A;&#x308A;&#x306B;
/usr/src/linux/drivers/usb/serial/visor.h &#x306B;patch&#x3092;&#x3042;&#x3066;&#x3066;&#x3001;
kernel module &#x3092; make install &#x3057;&#x307E;&#x3057;&#x305F;&#x3002;

&#x305D;&#x306E;&#x5F8C;&#x3001;

  # ln -s /dev/ttyUSB0 /dev/pilot

&#x3068;&#x3057;&#x3066; /dev/pilot &#x306B;&#x30EA;&#x30F3;&#x30AF;&#x3092;&#x306F;&#x308A;&#x3001;pilot-link-0.10.99 &#x306E;
pilot-xfer &#x3092;&#x4EE5;&#x4E0B;&#x306E;&#x624B;&#x9806;&#x3067;&#x5B9F;&#x884C;&#x3057;&#x307E;&#x3057;&#x305F;&#x3002;

    1. &#x30AF;&#x30EC;&#x30FC;&#x30C9;&#x30EB;&#x306E;HotSync&#x30DC;&#x30BF;&#x30F3;&#x3092;&#x62BC;&#x3059;&#x3002;
    2. % pilot-xfer -l
       No $PILOTPORT specified and no -p &lt;port&gt; given.
       Defaulting to '/dev/pilot'

         Listening to port: /dev/pilot

         Please press the HotSync button now... Connected

       Reading list of databases in RAM...
       ATD2Lrn
       ATD2Engn
       ...
      &#x3068;&#x3001;Clie &#x306B;&#x5165;&#x3063;&#x3066;&#x3044;&#x308B;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x304C;&#x8868;&#x793A;&#x3055;&#x308C;&#x307E;&#x3057;&#x305F;&#x3002;

jpilot-0.99.2 &#x3082;&#x3046;&#x307E;&#x304F;&#x52D5;&#x4F5C;&#x3057;&#x307E;&#x3057;&#x305F;&#x304C;&#x3001;mhc2palm, palm2mhc &#x306F;
pilot-link-0.9.3 &#x3092;&#x5143;&#x306B;&#x3057;&#x3066;&#x3044;&#x308B;&#x306E;&#x3067;&#x3046;&#x307E;&#x304F;&#x52D5;&#x304D;&#x307E;&#x305B;&#x3093;&#x3067;&#x3057;&#x305F;&#x3002;

&#x305D;&#x3053;&#x3067; jpilot-0.99.2 &#x306E; source &#x3092;&#x5143;&#x306B; mhc_pilib.c &#x3078;&#x306E;
patch &#x3092;&#x4F5C;&#x6210;&#x3057;&#x3066; mhc_pilib.so &#x3092;&#x4F5C;&#x308A;&#x76F4;&#x3057;&#x305F;&#x3068;&#x3053;&#x308D;&#x3001;&#x3046;&#x307E;&#x304F;&#x3044;&#x304D;&#x307E;&#x3057;&#x305F;&#x3002;

patch (mhc_pilib.c.usb.diff) &#x3092;&#x3053;&#x306E;&#x30E1;&#x30FC;&#x30EB;&#x306B;&#x6DFB;&#x4ED8;&#x3057;&#x307E;&#x3059;&#x3002;
&#x672C;&#x65E5; CVS &#x3067;&#x53D6;&#x3063;&#x3066;&#x304D;&#x305F; mhc-current &#x306B;&#x5BFE;&#x5FDC;&#x3057;&#x3066;&#x3044;&#x307E;&#x3059;&#x3002;
&#x4EE5;&#x4E0B;&#x306E;&#x901A;&#x308A;&#x306B; patch &#x3092;&#x3042;&#x3066;&#x3066;&#x304F;&#x3060;&#x3055;&#x3044;&#x3002;

    % cd mhc/ruby-ext
    % patch &lt; mhc_pilib.c.usb.diff
    % cd ..
    % ruby configure.rb
    % ruby make.rb
    # ruby make.rb install

mhc_pilib.c.usb.diff &#x306F;

 o pilot-link-0.10.99 &#x5BFE;&#x5FDC;
 o USB &#x30C7;&#x30D0;&#x30A4;&#x30B9;&#x5BFE;&#x5FDC;

&#x3068;&#x306A;&#x3063;&#x3066;&#x3044;&#x308B;&#x306F;&#x305A;&#x3067;&#x3059;&#x3002;&#x672C;patch&#x9069;&#x5FDC;&#x5F8C;&#x3082;&#x3001;&#x5143;&#x306E; pilot-link-0.9.3&#x3001;
&#x30B7;&#x30EA;&#x30A2;&#x30EB;&#x30AF;&#x30EC;&#x30FC;&#x30C9;&#x30EB;&#x3067;&#x306E;&#x30B3;&#x30F3;&#x30D1;&#x30A4;&#x30EB;&#x3001;&#x52D5;&#x4F5C;&#x306B;&#x5F71;&#x97FF;&#x306F;&#x306A;&#x3044;&#x306F;&#x305A;&#x3067;&#x3059;&#x3002;
&#x304A;&#x8A66;&#x3057;&#x3044;&#x305F;&#x3060;&#x3051;&#x305F;&#x3089;&#x5E78;&#x3044;&#x3067;&#x3059;&#x3002;
-- 
Akira Funahashi/&#x821F;&#x6A4B; &#x5553;
[funa@xxxxxxxx]
</pre><pre>--- mhc_pilib.c.dist	Mon May 29 23:59:25 2000
+++ mhc_pilib.c	Wed Jun 19 22:42:26 2002
@@ -24,6 +24,20 @@
 #include &quot;pi-address.h&quot;
 #include &quot;pi-appinfo.h&quot;
 
+/* Try to determine if version of pilot-link &gt; 0.9.x */
+#ifdef USB_PILOT_LINK
+# undef USB_PILOT_LINK
+#endif
+
+#if PILOT_LINK_VERSION &gt; 0
+# define USB_PILOT_LINK
+#else
+# if PILOT_LINK_MAJOR &gt; 9
+#  define USB_PILOT_LINK
+# endif
+#endif
+
+
 VALUE mPiLib;
 
 /*************************************************************/
@@ -34,7 +48,10 @@
 static VALUE rpi_sock_open(VALUE obj, VALUE dev)
 {
   int sd;
+  int i, ret;
+  int dev_usb;
   struct pi_sockaddr addr;
+  char link[256], dev_str[256], dev_dir[256], *Pc;
 
   Check_Type(dev, T_STRING);
 
@@ -42,13 +59,78 @@
     return Qnil;
 
   strcpy(addr.pi_device, STR2CSTR(dev));
-  addr.pi_family = PI_AF_SLP;
 
+  /* pilot-link &gt; 0.9.5 needed for many USB devices */
+#ifdef USB_PILOT_LINK
+  /* Newer pilot-link */
+  addr.pi_family = PI_AF_PILOT;
+  if (!(sd = pi_socket(PI_AF_PILOT, PI_SOCK_STREAM, PI_PF_DLP)))
+    return Qnil;
+#else
+  /* 0.9.5 or older */
+  addr.pi_family = PI_AF_SLP;
   if (!(sd = pi_socket(PI_AF_SLP, PI_SOCK_STREAM, PI_PF_PADP)))
     return Qnil;
+#endif
 
-  if (pi_bind(sd, (struct sockaddr*)&amp;addr, sizeof(addr)) &lt; 0)
-    return Qnil;
+  /* This is for USB, whose device doesn't exist until the cradle is pressed
+   * We will give them 5 seconds */
+  dev_str[0]='\0';
+  link[0]='\0';
+  strncpy(dev_str, STR2CSTR(dev), 255);
+  strncpy(dev_dir, STR2CSTR(dev), 255);
+  dev_str[255]='0';
+  dev_dir[255]='0';
+  dev_usb=0;
+  for (Pc=&amp;dev_dir[strlen(dev_dir)-1]; Pc&gt;dev_dir; Pc--) {
+	if (*Pc=='/') *Pc='\0';
+	else break;
+  }
+  Pc = strrchr(dev_dir, '/');
+  if(Pc) {
+    *Pc = '\0';
+  }
+  for (i=10; i&gt;0; i--) {
+   	  ret = readlink(dev_str, link, 256);
+	  if (ret&gt;0) {
+		  link[ret]='\0';
+      } else {
+     if (strstr(dev_str, &quot;usb&quot;) || strstr(dev_str, &quot;USB&quot;)) {
+        dev_usb=1;
+     }
+     break;
+      }
+      if (link[0]=='/') {
+     strcpy(dev_str, link);
+     strcpy(dev_dir, link);
+     for (Pc=&amp;dev_dir[strlen(dev_dir)-1]; Pc&gt;dev_dir; Pc--) {
+        if (*Pc=='/') *Pc='\0';
+        else break;
+     }
+     Pc = strrchr(dev_dir, '/');
+     if (Pc) {
+        *Pc = '\0';
+     }
+      } else {
+     snprintf(dev_str, 255, &quot;%s/%s&quot;, dev_dir, link);
+     dev_str[255]='\0';
+      }
+      if (strstr(link, &quot;usb&quot;) || strstr(link, &quot;USB&quot;)) {
+     dev_usb=1;
+     break;
+      }
+   }
+
+  if (dev_usb) {
+	  for (i=7; i&gt;0; i--) {
+		  ret = pi_bind(sd, (struct sockaddr*)&amp;addr, sizeof(addr));
+		  if (ret!=-1) break;
+		  sleep(1);
+	  }
+  } else {
+	  ret = pi_bind(sd, (struct sockaddr*)&amp;addr, sizeof(addr));
+  }
+  if (ret == -1) return Qnil;
 
   return INT2FIX(sd);
 }
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="01582" href="msg01582.html">[mhc:01583] Re: Palm</a></strong>
<ul><li><em>From:</em> Yoshinari Nomura</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01564" href="msg01564.html">[mhc:01565] Re: Palm</a></strong>
<ul><li><em>From:</em> Toyonobu Sawada</li></ul></li>
<li><strong><a name="01565" href="msg01565.html">[mhc:01566] Re: Palm</a></strong>
<ul><li><em>From:</em> KOSEKI Yoshinori</li></ul></li>
<li><strong><a name="01566" href="msg01566.html">[mhc:01567] Re: Palm</a></strong>
<ul><li><em>From:</em> Toyonobu Sawada</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01580.html">[mhc:01581] Re: jpilot (Re: Palm)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01582.html">[mhc:01583] Re: Palm</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01568.html">[mhc:01569] Re: Palm</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01582.html">[mhc:01583] Re: Palm</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01581"><strong>Date</strong></a></li>
<li><a href="threads.html#01581"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
