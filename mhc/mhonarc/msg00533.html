<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:00534] Re: mhc&#45;cvs.el -->
<!--X-From-R13: FEGQVWKO [nfngbfuv <gfhpuvlnNcvar.xhrr.xlbgb&#45;h.np.wc> -->
<!--X-Date: Mon, 24 Apr 2000 23:53:39 +0900 -->
<!--X-Message-Id: 200004241453.XAA27481@crest.csce.kyushu&#45;u.ac.jp -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: mpad7nnoeyn.fsf@olive.kuee.kyoto&#45;u.ac.jp -->
<!--X-Reference: 20000419.184234.126688598.shirai@rdmg.mgcs.mei.co.jp -->
<!--X-Reference: 200004191506.AAA10943@crest.csce.kyushu&#45;u.ac.jp -->
<!--X-Reference: 20000420.100909.46106138.shirai@rdmg.mgcs.mei.co.jp -->
<!--X-Reference: mpa66tdwlcw.fsf@olive.kuee.kyoto&#45;u.ac.jp -->
<!--X-Reference: 20000420111403A.nom@csce.kyushu&#45;u.ac.jp -->
<!--X-Reference: 20000420.123140.100582886.shirai@rdmg.mgcs.mei.co.jp -->
<!--X-Reference: mpapurlv1l6.fsf@olive.kuee.kyoto&#45;u.ac.jp -->
<!--X-Reference: 20000420124834Q.nom@csce.kyushu&#45;u.ac.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:00534] Re: mhc-cvs.el</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00532.html">Date Prev</a>][<a href="msg00534.html">Date Next</a>][<a href="msg00528.html">Thread Prev</a>][<a href="msg00534.html">Thread Next</a>][<a href="maillist.html#00533">Date Index</a>][<a href="threads.html#00533">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:00534] Re: mhc-cvs.el</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:00534] Re: mhc-cvs.el</li>
<li><em>From</em>: TSUCHIYA Masatoshi &lt;<a href="mailto:tsuchiya@DOMAIN.HIDDEN">tsuchiya@xxxxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 24 Apr 2000 23:53:39 +0900</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:mpapurlv1l6.fsf@DOMAIN.HIDDEN">mpapurlv1l6.fsf@xxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; (TSUCHIYA Masatoshi's message of &quot;Thu, 20 Apr 2000 13:27:37 +0900&quot;)</li>
<li><em>Posted</em>: 24 Apr 2000 23:53:23 +0900</li>
<li><em>References</em>: &lt;<a href="mailto:mpad7nnoeyn.fsf@DOMAIN.HIDDEN">mpad7nnoeyn.fsf@xxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20000419.184234.126688598.shirai@DOMAIN.HIDDEN">20000419.184234.126688598.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:200004191506.AAA10943@DOMAIN.HIDDEN">200004191506.AAA10943@xxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20000420.100909.46106138.shirai@DOMAIN.HIDDEN">20000420.100909.46106138.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:mpa66tdwlcw.fsf@DOMAIN.HIDDEN">mpa66tdwlcw.fsf@xxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20000420111403A.nom@DOMAIN.HIDDEN">20000420111403A.nom@xxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20000420.123140.100582886.shirai@DOMAIN.HIDDEN">20000420.123140.100582886.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:mpapurlv1l6.fsf@DOMAIN.HIDDEN">mpapurlv1l6.fsf@xxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20000420124834Q.nom@DOMAIN.HIDDEN">20000420124834Q.nom@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>User-agent</em>: T-gnus/6.14.2 (based on Gnus v5.8.4) SEMI/1.13.7 (Awazu) FLIM/1.13.2 (Kasanui) Emacs/20.6 (i686-pc-linux-gnu) MULE/4.0 (HANANOEN)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&#x571F;&#x5C4B;&#x3067;&#x3059;&#x3002;


&gt;&gt; On Thu, 20 Apr 2000 13:27:37 +0900
&gt;&gt; &#x300C;&#x571F;&#x300D;== tsuchiya@xxxxxxxxxxxxxxxxxxxxxxx (TSUCHIYA Masatoshi) said as follows:

&#x571F;&gt; &#x3067;&#x3001;cvs add &#x304A;&#x3088;&#x3073; cvs remove &#x306F;&#x3001;&#x5B8C;&#x5168;&#x306A;&#x30AA;&#x30D5;&#x30E9;&#x30A4;&#x30F3;&#x74B0;&#x5883;&#x3067;&#x3082;&#x3001;&#x3044;&#x3064;&#x3067;&#x3082;&#x5B9F;
&#x571F;&gt; &#x884C;&#x53EF;&#x80FD;&#x306A;&#x306F;&#x305A;&#x3060;&#x3068;&#x8003;&#x3048;&#x3066;&#x3044;&#x305F;&#x306E;&#x3067;&#x3059;&#x304C;&#x3001;&#x3053;&#x308C;&#x304C;&#x9593;&#x9055;&#x3044;&#x306A;&#x306E;&#x3067;&#x3057;&#x3087;&#x3046;&#x304B;?

&#x767D;&#x4E95;&gt; &#x3053;&#x3061;&#x3089;&#x306E;&#x554F;&#x984C;&#x3067;&#x3059;&#x3002;&#x74B0;&#x5883;&#x306F;&#x6628;&#x65E5;&#x3082;&#x66F8;&#x304D;&#x307E;&#x3057;&#x305F;&#x3051;&#x3069;&#x3001;Win95 + NotePC +
&#x767D;&#x4E95;&gt; cvs-1.10.5 &#x3067;&#x3059;&#x3002; offline &#x72B6;&#x614B;&#x3067; (server &#x3092;&#x96A0;&#x3059;&#x3053;&#x3068;&#x3082;&#x306A;&#x3044;&#x3051;&#x3069;)

&#x571F;&gt; &#x3046;&#x30FC;&#x3093;&#x3002;&#x305D;&#x3046;&#x3060;&#x3063;&#x305F;&#x3093;&#x3067;&#x3059;&#x304B;&#x2026;&#x3002;&#x3053;&#x3044;&#x3064;&#x306F;&#x56F0;&#x308A;&#x307E;&#x3057;&#x305F;&#x306D;&#x3002;CVS &#x306B;&#x3088;&#x308B;&#x7BA1;&#x7406;&#x306E;&#x9B45;
&#x571F;&gt; &#x529B;&#x304C;&#x3042;&#x3063;&#x3068;&#x3044;&#x3046;&#x307E;&#x306B;&#x306A;&#x304F;&#x306A;&#x3063;&#x3066;&#x3057;&#x307E;&#x3044;&#x307E;&#x3057;&#x305F;&#x3002;

&#x3053;&#x306E;&#x554F;&#x984C;&#x306B;&#x95A2;&#x3057;&#x3066;&#x3001;&#x3068;&#x308A;&#x3042;&#x3048;&#x305A;&#x30AA;&#x30D5;&#x30E9;&#x30A4;&#x30F3;&#x72B6;&#x614B;&#x6642;&#x306B;&#x306F; cvs add / remove &#x3092;&#x884C;
&#x308F;&#x305A;&#x3001;&#x30AA;&#x30F3;&#x30E9;&#x30A4;&#x30F3;&#x72B6;&#x614B;&#x306B;&#x306A;&#x3063;&#x305F;&#x5F8C;&#x3067; cvs add / remove &#x3092;&#x884C;&#x3046;&#x3088;&#x3046;&#x306B;&#x5909;&#x66F4;&#x3057;&#x3066;
&#x307F;&#x307E;&#x3057;&#x305F;&#x3002;

## [mhc:00529] &#x306E;&#x30D1;&#x30C3;&#x30C1;&#x3092;&#x9069;&#x7528;&#x3057;&#x305F;&#x5F8C;&#x306B;&#x3042;&#x3066;&#x308B;&#x3088;&#x3046;&#x306B;&#x306A;&#x3063;&#x3066;&#x3044;&#x307E;&#x3059;&#x3002;

</pre><pre>Index: mhc-cvs.el
===================================================================
RCS file: /home/tsuchiya/CVS/projects/mhc/mhc-cvs.el,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -r1.6 -r1.7
--- mhc-cvs.el	2000/04/20 09:25:01	1.6
+++ mhc-cvs.el	2000/04/24 14:36:08	1.7
@@ -34,6 +34,7 @@
 ;; &#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092; CVS &#x3092;&#x901A;&#x3057;&#x3066;&#x7BA1;&#x7406;&#x3059;&#x308B;&#x3088;&#x3046;&#x306B;&#x306A;&#x308B;&#x3002;
 
 ;;; Definition
+(eval-when-compile (require 'cl))
 (provide 'mhc-cvs)
 (put 'mhc-cvs 'open   'mhc-cvs/open)
 (put 'mhc-cvs 'close  'mhc-cvs/close)
@@ -89,22 +90,65 @@
 
 (defun mhc-cvs/sync ()
   &quot;&#x30EA;&#x30E2;&#x30FC;&#x30C8;&#x306E;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3068;&#x30ED;&#x30FC;&#x30AB;&#x30EB;&#x306E;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x306E;&#x540C;&#x671F;&#x3092;&#x53D6;&#x308B;&#x95A2;&#x6570;&quot;
+  (mhc-cvs/delay-add-and-remove (mhc-summary-folder-to-path mhc-base-folder))
   (mhc-cvs/update)
   t) ; return value
 
+(defun mhc-cvs/delay-add-and-remove (dir)
+  (dolist (entry (directory-files dir nil nil t))
+    (cond
+     ;; &#x30AA;&#x30D5;&#x30E9;&#x30A4;&#x30F3;&#x72B6;&#x614B;&#x306E;&#x6642;&#x306B;&#x8FFD;&#x52A0;&#x3055;&#x308C;&#x305F;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x5B9F;&#x969B;&#x306B;&#x8FFD;&#x52A0;&#x3059;&#x308B;
+     ((string-match &quot;^\\.mhc-cvs-added-&quot; entry)
+      (mhc-cvs/add (expand-file-name (substring entry (match-end 0)) dir))
+      (mhc-misc-touch-directory dir))
+     ;; &#x30AA;&#x30D5;&#x30E9;&#x30A4;&#x30F3;&#x72B6;&#x614B;&#x306E;&#x6642;&#x306B;&#x524A;&#x9664;&#x3055;&#x308C;&#x305F;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x5B9F;&#x969B;&#x306B;&#x524A;&#x9664;&#x3059;&#x308B;
+     ((string-match &quot;^\\.mhc-cvs-removed-&quot; entry)
+      (mhc-cvs/remove (expand-file-name (substring entry (match-end 0)) dir))
+      (mhc-misc-touch-directory dir))
+     ;; . &#x3067;&#x59CB;&#x307E;&#x308B;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x306F;&#x7121;&#x8996;&#x3059;&#x308B;
+     ((string-match &quot;^\\.&quot; entry) t)
+     ;; CVS &#x306E;&#x4F5C;&#x696D;&#x7528;&#x306E;&#x30C7;&#x30A3;&#x30EC;&#x30AF;&#x30C8;&#x30EA;&#x306F;&#x7121;&#x8996;&#x3059;&#x308B;
+     ((string= &quot;CVS&quot; entry) t)
+     ;; &#x30C7;&#x30A3;&#x30EC;&#x30AF;&#x30C8;&#x30EA;&#x3092;&#x518D;&#x5E30;&#x7684;&#x306B;&#x51E6;&#x7406;&#x3059;&#x308B;
+     ((file-directory-p (expand-file-name entry dir))
+      (mhc-cvs/delay-add-and-remove (expand-file-name entry dir))))))
+
+(defun mhc-cvs/get-added-flag-file-name (filename)
+  (expand-file-name (format &quot;.mhc-cvs-added-%s&quot;
+			    (file-name-nondirectory filename))
+		    (file-name-directory filename)))
+
+(defun mhc-cvs/get-removed-file-name (filename)
+  (expand-file-name (format &quot;.mhc-cvs-removed-%s&quot;
+			    (file-name-nondirectory filename))
+		    (file-name-directory filename)))
+
 (defun mhc-cvs/add (filename &amp;optional offline)
   &quot;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x8FFD;&#x52A0;&#x3059;&#x308B;&#x95A2;&#x6570;&quot;
-  (and (= 0 (mhc-cvs/backend &quot;add&quot; filename)) (mhc-cvs/modify filename offline)))
+  (let ((added (mhc-cvs/get-added-flag-file-name filename))
+	(removed (mhc-cvs/get-removed-file-name filename)))
+    (if (file-exists-p removed) (delete-file removed))
+    (if offline
+	(not (make-symbolic-link filename added t))
+      (if (file-exists-p added) (delete-file added))
+      (and (= 0 (mhc-cvs/backend &quot;add&quot; filename))
+	   (mhc-cvs/modify filename)))))
 
+(defun mhc-cvs/remove (filename &amp;optional offline)
+  &quot;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x524A;&#x9664;&#x3059;&#x308B;&#x95A2;&#x6570;&quot;
+  (let ((added (mhc-cvs/get-added-flag-file-name filename))
+	(removed (mhc-cvs/get-removed-file-name filename)))
+    (if (file-exists-p added) (delete-file added))
+    (if offline
+	(not (rename-file filename removed t))
+      (if (file-exists-p removed) (delete-file removed))
+      (if (file-exists-p filename) (delete-file filename))
+      (and (= 0 (mhc-cvs/backend &quot;remove&quot; filename))
+	   (mhc-cvs/modify filename)))))
+
 (defun mhc-cvs/modify (filename &amp;optional offline)
   &quot;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x5909;&#x66F4;&#x3059;&#x308B;&#x95A2;&#x6570;&quot;
   (or offline (= 0 (mhc-cvs/backend &quot;commit&quot; &quot;-m&quot; &quot;&quot; filename))))
-
-(defun mhc-cvs/remove (filename &amp;optional offline)
-  &quot;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x3092;&#x524A;&#x9664;&#x3059;&#x308B;&#x95A2;&#x6570;&quot;
-  (delete-file filename)
-  (and (= 0 (mhc-cvs/backend &quot;remove&quot; filename))
-       (mhc-cvs/modify filename offline)))
 
 
 ;;; CVS Backend Function
</pre><pre>
&#x30AA;&#x30D5;&#x30E9;&#x30A4;&#x30F3;&#x72B6;&#x614B;&#x306E;&#x307E;&#x307E;&#x3067;&#x3001;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x540D;&#x306E;&#x540C;&#x3058;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x3092;&#x8FFD;&#x52A0;&#x3057;&#x305F;&#x308A;&#x3001;&#x524A;&#x9664;
&#x3057;&#x305F;&#x308A;&#x3059;&#x308B;&#x3068;&#x3001;&#x305D;&#x306E;&#x9593;&#x306E;&#x5C65;&#x6B74;&#x304C;&#x5931;&#x308F;&#x308C;&#x3066;&#x3057;&#x307E;&#x3044;&#x307E;&#x3059;&#x306E;&#x3067;&#x3001;&#x904B;&#x7528;&#x3067;&#x6CE8;&#x610F;&#x3057;&#x3066;&#x304F;&#x3060;
&#x3055;&#x3044;&#x3002;cvs commit &#x305B;&#x305A;&#x306B;&#x5909;&#x66F4;&#x3057;&#x3066;&#x3044;&#x308B;&#x308F;&#x3051;&#x306A;&#x306E;&#x3067;&#x3001;&#x305D;&#x306E;&#x9593;&#x306E;&#x5C65;&#x6B74;&#x304C;&#x5931;&#x308F;&#x308C;&#x308B;
&#x306E;&#x306F;&#x5F53;&#x7136;&#x3068;&#x8A00;&#x3048;&#x3070;&#x5F53;&#x7136;&#x306A;&#x306E;&#x3067;&#x3059;&#x304C;&#x2026;&#x3002;


-- 
&#x571F;&#x5C4B; &#x96C5;&#x7A14;  ( TSUCHIYA Masatoshi )
    <a  rel="nofollow" href="http://www-nagao.kuee.kyoto-u.ac.jp/member/tsuchiya/">http://www-nagao.kuee.kyoto-u.ac.jp/member/tsuchiya/</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00534" href="msg00534.html">[mhc:00535] Re: mhc-cvs.el</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00502" href="msg00502.html">[mhc:00503] Re: mhc-cvs.el</a></strong>
<ul><li><em>From:</em> TSUCHIYA Masatoshi</li></ul></li>
<li><strong><a name="00505" href="msg00505.html">[mhc:00506] Re: mhc-cvs.el</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="00507" href="msg00507.html">[mhc:00508] mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> TSUCHIYA Masatoshi</li></ul></li>
<li><strong><a name="00510" href="msg00510.html">[mhc:00511] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="00513" href="msg00513.html">[mhc:00514] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> TSUCHIYA Masatoshi</li></ul></li>
<li><strong><a name="00512" href="msg00512.html">[mhc:00513] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> Yoshinari NOMURA</li></ul></li>
<li><strong><a name="00516" href="msg00516.html">[mhc:00517] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="00518" href="msg00518.html">[mhc:00519] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> TSUCHIYA Masatoshi</li></ul></li>
<li><strong><a name="00517" href="msg00517.html">[mhc:00518] Re: mhc-cvs.el and Gnus support</a></strong>
<ul><li><em>From:</em> Yoshinari NOMURA</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00532.html">[mhc:00533] Re: T-gnus support</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00534.html">[mhc:00535] Re: mhc-cvs.el</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00528.html">[mhc:00529] Re: mhc-cvs.el and Gnus support</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00534.html">[mhc:00535] Re: mhc-cvs.el</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00533"><strong>Date</strong></a></li>
<li><a href="threads.html#00533"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
