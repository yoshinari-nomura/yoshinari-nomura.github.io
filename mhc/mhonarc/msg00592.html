<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:00593] Re: mhc&#45;calendar.el -->
<!--X-From-R13: Kbfuvanev @A[GDO <abzNpfpr.xlhfuh&#45;h.np.wc> -->
<!--X-Date: Sun, 14 May 2000 01:08:55 +0900 -->
<!--X-Message-Id: 20000514010853J.nom@csce.kyushu&#45;u.ac.jp -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20000509.195533.120896414.shirai@rdmg.mgcs.mei.co.jp -->
<!--X-Reference: 20000510181240C.nom@csce.kyushu&#45;u.ac.jp -->
<!--X-Reference: 20000510.200042.33492196.shirai@rdmg.mgcs.mei.co.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:00593] Re: mhc-calendar.el</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00591.html">Date Prev</a>][<a href="msg00593.html">Date Next</a>][<a href="msg00588.html">Thread Prev</a>][<a href="msg00599.html">Thread Next</a>][<a href="maillist.html#00592">Date Index</a>][<a href="threads.html#00592">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:00593] Re: mhc-calendar.el</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:00593] Re: mhc-calendar.el</li>
<li><em>From</em>: Yoshinari NOMURA &lt;<a href="mailto:nom@DOMAIN.HIDDEN">nom@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Sun, 14 May 2000 01:08:55 +0900</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:20000510.200042.33492196.shirai@DOMAIN.HIDDEN">20000510.200042.33492196.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Posted</em>: Sun, 14 May 2000 01:08:53 +0900</li>
<li><em>References</em>: &lt;<a href="mailto:20000509.195533.120896414.shirai@DOMAIN.HIDDEN">20000509.195533.120896414.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20000510181240C.nom@DOMAIN.HIDDEN">20000510181240C.nom@xxxxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20000510.200042.33492196.shirai@DOMAIN.HIDDEN">20000510.200042.33492196.shirai@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&#x4E43;&#x6751;&#x3067;&#x3059;&#x3002;&#x5B9F;&#x306F;&#x73FE;&#x5B9F;&#x9003;&#x907F;&#x3002;&#x3002;

# &#x50D5;&#x3063;&#x3066;&#x3001;&#x3064;&#x304F;&#x3065;&#x304F;&#x6587;&#x7AE0;&#x66F8;&#x304F;&#x306E;&#x5ACC;&#x3044;&#x306A;&#x3093;&#x3060;&#x306A;&#x3002;&#x3002;&#x3088;&#x304F;&#x3001;&#x3053;&#x306E;&#x5546;&#x58F2;&#x3084;&#x3063;&#x3066;&#x308B;&#x306A;&#x3002;

On Wed, 10 May 2000 20:01:49 +0900,
	Hideyuki SHIRAI (&#x767D;&#x4E95;&#x79C0;&#x884C;) &lt;shirai@xxxxxxxxxxxxxxxxxxx&gt; said:

&gt; 1. &#x3044;&#x308D;&#x3093;&#x306A;&#x3068;&#x3053;&#x308D;&#x304B;&#x3089; M-x mhc-calendar &#x3092;&#x3055;&#x308C;&#x308B;&#x3068;&#x3001;&#x3069;&#x3053;&#x304B;&#x3089;&#x547C;&#x3070;
&gt;  &#x308C;&#x305F;&#x306E;&#x304B;&#x79C1;&#x306E;&#x6280;&#x8853;&#x529B;&#x3067;&#x306F;&#x308F;&#x304B;&#x3089;&#x306A;&#x304F;&#x306A;&#x308B;&#x3002;

&#x306A;&#x308B;&#x307B;&#x3069;&#x3002;invoke &#x3055;&#x308C;&#x305F;&#x3068;&#x304D;&#x306B;&#x3001;
 (setq mhc-calendar-parent-buffer (current-buffer)) ;; &#x5909;&#x6570;&#x540D;&#x9069;&#x5F53;

&#x3092;&#x5B9F;&#x884C;&#x3059;&#x308B;&#x3060;&#x3051;&#x3067;&#x306F;&#x30C0;&#x30E1;&#x306A;&#x3093;&#x3067;&#x3057;&#x305F;&#x3063;&#x3051;&#x3002;

&gt; 2. &#x305D;&#x306E;&#x304B;&#x308F;&#x308A;&#x306B;&#x3001;&quot;/&quot;, &quot;,&quot; &#x3092;&#x4F5C;&#x3063;&#x305F;&#x304B;&#x3089;&#x3001;&#x307E;&#x3041;&#x3044;&#x3044;&#x304B;&#x3002;

&#x306F;&#x3044;&#x3002;&#x3044;&#x308D;&#x3093;&#x306A;&#x6240;&#x306B;&#x633F;&#x5165;&#x3067;&#x304D;&#x3066;&#x3001;&#x3053;&#x308C;&#x3082;&#x4FBF;&#x5229;&#x3067;&#x3059;&#x306D;&#x3002;

&gt; # &#x6C17;&#x306B;&#x5165;&#x3089;&#x306A;&#x3044;&#x306E;&#x306F; &quot;2000/05/12&quot; &#x3058;&#x3083;&#x306A;&#x304F;&#x3066;&#x3001;&#x672C;&#x5F53;&#x306F; &quot;5/12/2000&quot;
&gt; # &#x3060;&#x305E;&#x3001;&#x3063;&#x3066;&#x3068;&#x3053;&#x308D;&#x304B;&#x306A;&#xFF1F;

&#x3046;&#x30FC;&#x3080;&#x3002;&#x4E16;&#x9593;&#x306E;&#x6163;&#x7FD2;&#x3068;&#x3057;&#x3066;&#x306F; 5/12/2000 &#x306A;&#x3093;&#x3067;&#x3057;&#x3087;&#x3046;&#x304B;&#x3002;
&#x5E74;&#x6708;&#x65E5;&#x306E;&#x9806;&#x306B;&#x5165;&#x308C;&#x3066;&#x3044;&#x304F;&#x65B9;&#x304C;&#x3001;&#x7701;&#x7565;&#x3057;&#x305F;&#x5834;&#x5408;&#x306E;&#x898F;&#x5247;&#x304C;&#x3059;&#x3063;&#x304D;&#x308A;&#x3057;&#x3066;&#x7D20;&#x76F4;&#x3060;&#x3068;
&#x601D;&#x3046;&#x306E;&#x306F;&#x50D5;&#x3060;&#x3051;?

&gt; &#x4E43;&#x6751;&gt; &#x3042;&#x308C;&#x3001;&#x65E5;&#x3060;&#x3051;&#x306E;&#x5834;&#x5408;&#x3082; guess &#x3057;&#x306A;&#x3044;&#x3093;&#x3067;&#x3057;&#x305F;&#x3063;&#x3051;&#x3002;&#x65E5;&#x3060;&#x3051;&#x306E;&#x3068;&#x3001;
&gt; &#x4E43;&#x6751;&gt; &#x300C;&#x6765;&#x9031;&#x306E;&#x91D1;&#x66DC;&#x65E5;&#x300D; &#x3082; guess &#x3059;&#x308B;&#x3088;&#x3046;&#x306B;&#x3057;&#x3066;&#x307F;&#x307E;&#x3057;&#x3087;&#x3046;&#x3002;
&gt; 
&gt; &#x3088;&#x308D;&#x3057;&#x304F;&#x304A;&#x9858;&#x3044;&#x3057;&#x307E;&#x3059;&#x3002;(_ _)

&#x3061;&#x3087;&#x3063;&#x3068;&#x5B9F;&#x9A13;&#x3057;&#x3066;&#x307F;&#x307E;&#x3057;&#x305F;&#x3002;&#x5F8C;&#x308D;&#x306B;&#x4ED8;&#x3051;&#x307E;&#x3059;&#x3002;
&#x305F;&#x3060;&#x3001;&#x7D20;&#x76F4;&#x306B;&#x3001;&#x300C;&#x91D1;&#x66DC;&#x65E5;&#x300D; &#x3084; &#x300C;15&#x65E5;&#x300D; &#x3068;&#x304B;&#x306B;&#x3082;&#x53CD;&#x5FDC;&#x3059;&#x308B;&#x3088;&#x3046;&#x306B;&#x3059;&#x308B;&#x3068;&#x3001;
guess &#x306E;&#x7CBE;&#x5EA6;&#x304C;&#x843D;&#x3061;&#x308B;&#x3093;&#x3067;&#x3059;&#x3088;&#x306D;&#x3002;

&#x306A;&#x306E;&#x3067;&#x3001;&#x73FE;&#x72B6;&#x3067;&#x306F;&#x3001;xx&#x6708;xx&#x65E5; &#x3084; xx/xx &#x304C;&#x307E;&#x3063;&#x305F;&#x304F;&#x898B;&#x4ED8;&#x3051;&#x3089;&#x308C;&#x306A;&#x304B;&#x3063;&#x305F;&#x3068;&#x304D;&#x3060;&#x3051;
&#x300C;&#x660E;&#x65E5;&#x300D; &#x3084; &#x300C;&#x6765;&#x9031;&#x306E;&#x91D1;&#x66DC;&#x65E5;&#x300D; &#x3084; &#x300C;15&#x65E5;&#x300D; &#x3082;&#x62FE;&#x3063;&#x3066;&#x6765;&#x308B;&#x3088;&#x3046;&#x306B;&#x3057;&#x3066;&#x3044;&#x307E;&#x3059;&#x3002;

&#x3082;&#x3046;&#x3061;&#x3087;&#x3063;&#x3068;&#x8003;&#x3048;&#x308B;&#x5FC5;&#x8981;&#x304C;&#x3042;&#x308A;&#x305D;&#x3046;&#x3067;&#x3059;&#x3002;

mhc &#x304C;&#x30ED;&#x30FC;&#x30C9;&#x3055;&#x308C;&#x3066;&#x3044;&#x308B;&#x72B6;&#x614B;&#x3067;&#x3001;M-x eval-current-buffer &#x3057;&#x3066;&#x4F7F;&#x3063;&#x3066;
&#x307F;&#x3066;&#x4E0B;&#x3055;&#x3044;&#x3002;

&gt; &#x4E43;&#x6751;&gt; &#x3082;&#x3061;&#x308D;&#x3093; yyyy/mm/dd &#x306E; dd &#x4EE5;&#x5916;&#x306F;&#x7701;&#x7565;&#x3067;&#x304D;&#x307E;&#x3059;&#x3002;
&gt; 
&gt; ### &#x3046;&#x3045;&#x3001;&#x77E5;&#x3089;&#x306A;&#x304B;&#x3063;&#x305F;&#x3002;2000 &#x304B;&#x3089;&#x6253;&#x3063;&#x3066;&#x3044;&#x307E;&#x3057;&#x305F;&#x3002;^^;;;

&#x3042;&#x3089;&#x3001;&#x767D;&#x4E95;&#x3055;&#x3093;&#x304C;&#x77E5;&#x3089;&#x306A;&#x3044;&#x3068;&#x3044;&#x3046;&#x3053;&#x3068;&#x306F;&#x3001;&#x307B;&#x3069;&#x3093;&#x3069;&#x306E;&#x4EBA;&#x306F;&#x77E5;&#x3089;&#x306A;&#x306E;&#x304B;&#x3082;&#x3002;

  15      &#x2026; &#x4ECA;&#x6708;&#x306E; 15&#x65E5;
  5/15 18 &#x2026; 5&#x6708; 15&#x65E5;&#x3068; 18&#x65E5;
  19-21   &#x2026; &#x4ECA;&#x6708;&#x306E; 19&#x65E5;&#x304B;&#x3089; 21&#x65E5;

# &#x3053;&#x3063;&#x305D;&#x308A;&#x3001;&#x30C9;&#x30AD;&#x30E5;&#x30E1;&#x30F3;&#x30C8;&#x306B;&#x66F8;&#x3044;&#x3066;&#x3042;&#x308B;&#x3064;&#x3082;&#x308A;&#x3002;&#x3002;

&gt; &#x3068;&#x304A;&#x3063;&#x3057;&#x3083;&#x3063;&#x3066;&#x4E0B;&#x3055;&#x3063;&#x305F;&#x306E;&#x3067;&#x3001;mhc*.el &#x306B;&#x3042;&#x305F;&#x308B;&#x30D1;&#x30C3;&#x30C1;&#x306B;&#x3057;&#x305F;&#x65B9;&#x304C;&#x304D;&#x308C;
&gt; &#x3044;&#x3067;&#x3059;&#x306D;&#x3002;

&#x305D;&#x3046;&#x3067;&#x3059;&#x306D; mhc-calendar &#x306F;&#x5225;&#x30D5;&#x30A1;&#x30A4;&#x30EB;&#x306B;&#x3057;&#x3066;&#x3001;
mhc.el &#x304B;&#x3089; mhc-calendar &#x306B;&#x95A2;&#x3059;&#x308B;&#x90E8;&#x5206;&#x3092;&#x629C;&#x3044;&#x3066;&#x518D;&#x69CB;&#x6210;&#x3057;&#x307E;&#x3057;&#x3087;&#x3046;&#x3002;

&#x6765;&#x9031;&#x306F;&#x6687;&#x306B;&#x306A;&#x308B;&#x4E88;&#x5B9A;&#x306A;&#x306E;&#x3067;&#x3001;0.25 &#x30EA;&#x30EA;&#x30FC;&#x30B9;&#x3057;&#x305F;&#x3089;&#x3001;pserver &#x7ACB;&#x3066;&#x307E;&#x3059;&#x3002;
--
nom


;;
;; regexp for rfc822 Date: field.
;;

(defvar date-field-regex
  ;; assuming  ``Tue,  9 May 2000 12:15:12 -0700 (PDT)''
  (concat 
   &quot;\\([0-9]+\\)[ \t]+&quot;                                   ;; day
   &quot;\\(Jan\\|Feb\\|Mar\\|Apr\\|May\\|Jun\\|&quot;              ;;
   &quot;Jul\\|Aug\\|Sep\\|Oct\\|Nov\\|Dec\\)[ \t]+&quot;           ;; month
   &quot;\\([0-9]+\\)[ \t]+&quot;                                   ;; year
   &quot;\\([0-9]+\\):\\([0-9]+\\)\\(:\\([0-9]+\\)\\)?[ \t]*&quot;  ;; hh:mm(:ss)?
   &quot;\\([A-Z][A-Z][A-Z]\\|[-+][0-9][0-9][0-9][0-9]\\)&quot;     ;; JST or +0900
   ))

;;
;; parse rfc822 Date: field.
;;

(defun ddate-new-from-rfc822-date (string)
  (if (and (stringp string) (string-match date-field-regex string))
      (let ((day (ddate-substring-to-int string 1))
	    (mon (substring string (match-beginning 2) (match-end 2)))
	    (year (ddate-substring-to-int string 3))
	    (min (+ (* 60 (ddate-substring-to-int string 4))
		    (ddate-substring-to-int string 5)))
	    (tz  (substring string (match-beginning 8) (match-end 8)))
	    tz-offset)
	(setq
	 year (cond
	       ((&lt; year 50)  (+ year 2000))
	       ((&lt; year 100) (+ year 1900))
	       (t            year))
	 mon (1+ (/ (string-match mon
				  &quot;JanFebMarAprMayJunJulAugSepOctNovDec&quot;) 3))
	 tz-offset (time-zone-string-to-minute-offset tz)
	 min (+ min tz-offset))
	(car (cond
	      ((&lt; min 0)
	       (setq min (+ min 1440))
	       (list (ddate-dec (ddate-new year mon day))
		     (dtime-new (/ min 60) (% min 60))
		     tz-offset))
	      ((&gt;= min 1440)
	       (setq min (- min 1440))
	       (list (ddate-inc (ddate-new year mon day))
		     (dtime-new (/ min 60) (% min 60))
		     tz-offset))
	      (t
	       (list (ddate-new year mon day)
		     (dtime-new (/ min 60) (% min 60))
		     tz-offset)))))))

;; according to our current time zone, 
;; convert timezone string into offset minutes
;;
;;   for example, if current time zone is in Japan, 
;;   convert &quot;GMT&quot; or &quot;+0000&quot; into 540.
(defun time-zone-string-to-minute-offset (timezone)
  (let ((tz (or (cdr (assoc timezone
			    '((&quot;PST&quot; . &quot;-0800&quot;) (&quot;PDT&quot; . &quot;-0700&quot;)
			      (&quot;MST&quot; . &quot;-0700&quot;) (&quot;MDT&quot; . &quot;-0600&quot;)
			      (&quot;CST&quot; . &quot;-0600&quot;) (&quot;CDT&quot; . &quot;-0500&quot;)
			      (&quot;EST&quot; . &quot;-0500&quot;) (&quot;EDT&quot; . &quot;-0400&quot;)
			      (&quot;AST&quot; . &quot;-0400&quot;) (&quot;NST&quot; . &quot;-0300&quot;)
			      (&quot;UT&quot;  . &quot;+0000&quot;) (&quot;GMT&quot; . &quot;+0000&quot;)
			      (&quot;BST&quot; . &quot;+0100&quot;) (&quot;MET&quot; . &quot;+0100&quot;)
			      (&quot;EET&quot; . &quot;+0200&quot;) (&quot;JST&quot; . &quot;+0900&quot;))))
		timezone))
	min
	offset)
    (if (string-match &quot;\\([-+]\\)\\([0-9][0-9]\\)\\([0-9][0-9]\\)&quot; tz)
	(progn
	  (setq min (* (+ (* 60 (ddate-substring-to-int tz 2))
			  (ddate-substring-to-int tz 3))
		       (if (string= &quot;+&quot; 
				    (substring tz 
					       (match-beginning 1)
					       (match-end 1)))
			   1 -1))
		offset (- (/ (car (current-time-zone)) 60) min))))))


;;
;; regex for get date strings.
;;
(setq gdate-date-regex-list
  '(
    (&quot;\\(\\([&#x6765;&#x4ECA;&#xFF10;-&#xFF19;0-9]+\\)[\n ]*&#x6708;\\)[\n ]*&#x306E;?[\n ]*\\([&#xFF10;-&#xFF19;0-9]+\\)&quot;
     gdate-make-date-from-mmdd 2 3)

    (&quot;\\([&#xFF10;-&#xFF19;0-9]+\\) *[&#xFF0F;/] *\\([&#xFF10;-&#xFF19;0-9]+\\)&quot;
     gdate-make-date-from-mmdd 1 2)

    throw

    (&quot;\\(&#x4ECA;&#x5EA6;\\|[&#x4ECA;&#x6765;&#x6B21;]&#x9031;\\|&#x518D;&#x6765;&#x9031;\\)[\n ]*&#x306E;?[\n ]*\\([&#x6708;&#x706B;&#x6C34;&#x6728;&#x91D1;&#x571F;&#x65E5;]\\)&#x66DC;&quot;
     gdate-make-date-from-relative-week 1 2)

    throw
    
    (&quot;\\([&#xFF10;-&#xFF19;0-9]+\\)[\n ]*&#x65E5;&quot;
     gdate-make-date-from-mmdd nil 1)

    (&quot;\\([&#x6708;&#x706B;&#x6C34;&#x6728;&#x91D1;&#x571F;&#x65E5;]\\)\n?&#x66DC;&quot;
     gdate-make-date-from-relative-week nil 1)

    (&quot;\\(&#x672C;&#x65E5;\\|&#x4ECA;&#x65E5;\\|&#x3042;&#x3059;\\|&#x3042;&#x3057;&#x305F;\\|&#x3042;&#x3055;&#x3063;&#x3066;\\|&#x660E;&#x65E5;\\|&#x660E;&#x5F8C;&#x65E5;\\)&quot;
     gdate-make-date-from-relative-day 1)
    ))

;;
;; returns (((ptr-begin . ptr-end) . ddate) ...)
;;
(defun gdate-gather-date-list (regexp-lst)
  (let ((ret nil)
	(now (or (ddate-new-from-rfc822-date (mhc-misc-hdr-value &quot;Date:&quot;))
		 (ddate-now)))
	date-list)
    (while regexp-lst
      (cond
       ((listp (car regexp-lst))
	(if (setq date-list
		  (gdate-gather-date-list2
		   (car (car regexp-lst))       ;; regexp
		   now                          ;; current date
		   (car (cdr (car regexp-lst))) ;; convfunc
		   (cdr (cdr (car regexp-lst))) ;; posision list
		   ))
	    (setq ret (nconc ret date-list))))
       ((and (string= &quot;throw&quot; (symbol-name (car regexp-lst))) ret)
	(setq regexp-lst nil)))
      (setq regexp-lst (cdr regexp-lst)))
    ret))

(defun gdate-gather-date-list2 (regexp now convfunc pos-list)
  (let* (lst ddate param-list p)
    (save-excursion
      ;; skip Header
      (goto-char (point-min))
      (re-search-forward &quot;^-*$&quot; nil t)
      ;; search candities.
      (while (re-search-forward regexp nil t)
	(setq  p pos-list
	       param-list nil)
	(while p
	  (setq param-list 
		(cons
		 (if (and (car p) (match-beginning (car p)))
		     (buffer-substring (match-beginning (car p))
				       (match-end       (car p)))
		   nil)
		 param-list))
	  (setq p (cdr p)))
	(if (setq ddate (apply 'funcall convfunc now (nreverse param-list)))
	    (setq lst (cons 
		       (cons (cons (match-beginning 0)
				   (match-end 0)) ddate) lst)))))
    (nreverse lst)))

(defun gdate-make-date-from-mmdd (now mm-str dd-str)
  (let ((data (match-data))
	(mm (if mm-str (gdate-string-to-int mm-str) 0))
	(dd (if dd-str (gdate-string-to-int dd-str) 0))
	(year-offset 0)
	ddate)
    (cond 
     ((string= mm-str &quot;&#x6765;&quot;)
      (setq mm (ddate-mm (ddate-mm-inc now))))
     ((string= mm-str &quot;&#x4ECA;&quot;)
      (setq mm (ddate-mm now)))
     ((= mm 0)
      (setq mm (ddate-mm now))))
    (if (not (setq ddate (ddate-new (ddate-yy now) mm dd t))) ;; noerror is t
	()
      ;; if ddate is past, assume the next year.
      (if (ddate&lt; ddate now)
	  (setq year-offset (1+ year-offset)))
      ;; if ddate is far future, assume the last year.
      (if (&lt; 300 (+ (ddate- ddate now) (* year-offset 365)))
	  (setq year-offset (1- year-offset)))
      (setq ddate (ddate-yy-inc ddate year-offset)))
    (store-match-data data)
    ddate))

(defun gdate-make-date-from-relative-day (now rel-word)
  (cond 
   ((null rel-word)
    nil)
   ((or (string= rel-word &quot;&#x4ECA;&#x65E5;&quot;) (string= rel-word &quot;&#x672C;&#x65E5;&quot;))
    now)
   ((or (string= rel-word &quot;&#x3042;&#x3059;&quot;)
	(string= rel-word &quot;&#x3042;&#x3057;&#x305F;&quot;)
	(string= rel-word &quot;&#x660E;&#x65E5;&quot;))
    (ddate-inc now))
   ((or (string= rel-word &quot;&#x3042;&#x3055;&#x3063;&#x3066;&quot;)
	(string= rel-word &quot;&#x660E;&#x5F8C;&#x65E5;&quot;))
    (ddate-inc (ddate-inc now)))))

(defun gdate-make-date-from-relative-week (now rel-word week)
  (let ((data (match-data))
	(ww (string-match week &quot;&#x65E5;&#x6708;&#x706B;&#x6C34;&#x6728;&#x91D1;&#x571F;&quot;))
	off
	(ddate (or now (ddate-now))))
    (setq off  (- ww (ddate-ww (or now (ddate-now)))))
    (if (string= week &quot;&#x65E5;&quot;) (setq off (+ 7 off)))
    (setq off
	  (cond
	   ((or (null rel-word)
		(string= rel-word &quot;&#x4ECA;&#x5EA6;&quot;)
		(string= rel-word &quot;&#x6B21;&quot;))
	    (if (&lt;= off 0) (+ 7 off) off))
	   ((string= rel-word &quot;&#x4ECA;&#x9031;&quot;) off)
	   ((string= rel-word &quot;&#x6765;&#x9031;&quot;)
	    (+ off 7))
	   ((string= rel-word &quot;&#x518D;&#x6765;&#x9031;&quot;)
	    (+ off 14))))
    (while (&lt; off 0)
      (setq ddate (ddate-dec ddate)
	    off (1+ off)))
    (while (&gt; off 0)
      (setq ddate (ddate-inc ddate)
	    off (1- off)))
    (store-match-data data)
    ddate
    ))
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00599" href="msg00599.html">[mhc:00600] Re: mhc-calendar.el</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00583" href="msg00583.html">[mhc:00584] Re: mhc-calendar.el</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="00587" href="msg00587.html">[mhc:00588] Re: mhc-calendar.el</a></strong>
<ul><li><em>From:</em> Yoshinari NOMURA</li></ul></li>
<li><strong><a name="00588" href="msg00588.html">[mhc:00589] Re: mhc-calendar.el</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00591.html">[mhc:00592] mhc-snap20000514.tar.gz</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00593.html">[mhc:00594] Re: mhc &lt;-&gt; Windows CE</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00588.html">[mhc:00589] Re: mhc-calendar.el</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00599.html">[mhc:00600] Re: mhc-calendar.el</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00592"><strong>Date</strong></a></li>
<li><a href="threads.html#00592"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
