<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:02170] Re: =?ISO&#45;2022&#45;JP?B?GyRCN0E8MCUoJWkhPCROGyhC?=	=?ISO&#45;2022&#45;JP?B?GyRCJUElJyVDJS8kSyREJCQkRjxBTGQbKEI=?= -->
<!--X-From-R13: Vvqrlhxv EVWDOW (=?vfb&#45;2022&#45;wc?P?UlDQD3WjLw0bAHCoYSW=?=) <fuvenvNdhvpxunpx.arg> -->
<!--X-Date: Tue, 04 Oct 2005 15:21:07 +0900 (JST) -->
<!--X-Message-Id: 20051004.152107.101056276.shirai.hideyuki@rdmg.mgcs.mei.co.jp -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 20051004.075116.193686121.shirai.hideyuki@meadowy.org -->
<!--X-Reference: 20051004.131527.07275264.nogunogu@mva.biglobe.ne.jp -->
<!--X-Reference: 20051004.142541.251357034.shirai.hideyuki@rdmg.mgcs.mei.co.jp -->
<!--X-Reference: 20051004.151123.86422591.nogunogu@mva.biglobe.ne.jp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:02170] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg02167.html">Date Prev</a>][<a href="msg02168.html">Date Next</a>][<a href="msg02167.html">Thread Prev</a>][<a href="msg02170.html">Thread Next</a>][<a href="maillist.html#02169">Date Index</a>][<a href="threads.html#02169">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:02170] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:02170] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</li>
<li><em>From</em>: Hideyuki SHIRAI (&#x767D;&#x4E95;&#x79C0;&#x884C;) &lt;<a href="mailto:shirai@DOMAIN.HIDDEN">shirai@xxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Tue, 04 Oct 2005 15:21:07 +0900 (JST)</li>
<li><em>Delivered-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:20051004.151123.86422591.nogunogu@DOMAIN.HIDDEN">20051004.151123.86422591.nogunogu@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:mhc-ctl@quickhack.net?body=help">mailto:mhc-ctl@quickhack.net?body=help</a>&gt;</li>
<li><em>List-id</em>: mhc.quickhack.net</li>
<li><em>List-owner</em>: &lt;<a href="mailto:mhc-admin@quickhack.net">mailto:mhc-admin@quickhack.net</a>&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:mhc@quickhack.net">mailto:mhc@quickhack.net</a>&gt;</li>
<li><em>List-software</em>: fml [fml 4.0.3 release (20011202/4.0.3)]</li>
<li><em>List-unsubscribe</em>: &lt;<a href="mailto:mhc-ctl@quickhack.net?body=unsubscribe">mailto:mhc-ctl@quickhack.net?body=unsubscribe</a>&gt;</li>
<li><em>Organization</em>: QuickHackers, Tokyo, JAPAN</li>
<li><em>References</em>: &lt;<a href="mailto:20051004.075116.193686121.shirai.hideyuki@DOMAIN.HIDDEN">20051004.075116.193686121.shirai.hideyuki@xxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20051004.131527.07275264.nogunogu@DOMAIN.HIDDEN">20051004.131527.07275264.nogunogu@xxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20051004.142541.251357034.shirai.hideyuki@DOMAIN.HIDDEN">20051004.142541.251357034.shirai.hideyuki@xxxxxxxxxxxxxxxxxxx</a>&gt;	&lt;<a href="mailto:20051004.151123.86422591.nogunogu@DOMAIN.HIDDEN">20051004.151123.86422591.nogunogu@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: NOGUCHI Yusuke &lt;nogunogu@xxxxxxxxxxxxxxxxx&gt; &#x3055;&#x3093;&#x66F0;&#x304F;
Subject: [mhc:02168] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;
Message-ID: &lt;20051004.151123.86422591.nogunogu@xxxxxxxxxxxxxxxxx&gt;
Date: Tue, 04 Oct 2005 15:11:23 +0900 (JST)

&gt; &gt; &#x3053;&#x308C;&#x306F;&#x3001;&#x3042;&#x304F;&#x307E;&#x3067;&#x3001;&#x4EE5;&#x524D;&#x91CE;&#x53E3;&#x3055;&#x3093;&#x304C;&#x9593;&#x9055;&#x3063;&#x3066;&#x767B;&#x9332;&#x3057;&#x305F;&#x3068;&#x304D;&#x306E;&#x6B8B;&#x9AB8;&#x3067;&#x3059;&#x3088;&#x306D;&#x3002;
&gt; 
&gt; &#x304A;&#x3049;&#x2026;&#x3002;&#x5927;&#x5909;&#x5931;&#x793C;&#x3057;&#x307E;&#x3057;&#x305F;&#x3002;&#x767D;&#x4E95;&#x3055;&#x3093;&#x306E;&#x5FA1;&#x6307;&#x6458;&#x3092;&#x53D7;&#x3051;&#x3066;&#x3001;schedule/ &#x4EE5;&#x4E0B;&#x3092;&#x3088;
&gt; &#x304F;&#x3088;&#x304F;&#x78BA;&#x8A8D;&#x3057;&#x3066;&#x307F;&#x305F;&#x3068;&#x3053;&#x308D;&#x3001;&#x4ECA;&#x56DE;&#x306E;&#x30D1;&#x30C3;&#x30C1;&#x3092;&#x4F5C;&#x6210;&#x3059;&#x308B;&#x306B;&#x3042;&#x305F;&#x308A;&#x3001;&#x5B9F;&#x9A13;&#x306E;&#x305F;&#x3081;&#x306B;
&gt; &#x4F5C;&#x6210;&#x3057;&#x3066;&#x3044;&#x305F;&#x30C0;&#x30DF;&#x30FC;(&#x4E0D;&#x6B63;&#x5F62;&#x5F0F;)&#x306E;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x304C;&#x6B8B;&#x3063;&#x305F;&#x307E;&#x307E;&#x3067;&#x3057;&#x305F;&#x2026;&#x3002;(&#x5168;&#x3066;
&gt; &#x6D88;&#x3057;&#x305F;&#x3082;&#x306E;&#x3068;&#x601D;&#x3044;&#x3053;&#x3093;&#x3067;&#x304A;&#x308A;&#x307E;&#x3057;&#x305F;&#x306E;&#x3067;&#x3001;&#x691C;&#x8A0E;&#x5916;&#x308C;&#x306E;&#x5BFE;&#x5FDC;&#x3092;&#x3057;&#x3066;&#x3044;&#x307E;&#x3057;&#x305F;)
&gt; 
&gt; % grep X-SC-Time schedule/**/*
&gt; :
&gt; X-SC-Time: 10:00 12:00
&gt; X-SC-Time: 9:00
&gt; : 

&#x4ECA;&#x307E;&#x3067;&#x306E;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;&#x30EB;&#x3092;&#x898B;&#x308B;&#x3068;&#x304D;&#x306B;&#x30A8;&#x30E9;&#x30FC;&#x3057;&#x3061;&#x3083;&#x3046;&#x3068;&#x56F0;&#x308B;&#x3051;&#x3069;&#x3001;&#x767B;&#x9332;&#x6642;
&#x306E;&#x30D1;&#x30FC;&#x30B9;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x3092;&#x53B3;&#x5BC6;&#x306B;&#x884C;&#x3046;&#x306E;&#x306F;&#x826F;&#x3044;&#x8003;&#x3048;&#x3060;&#x3068;&#x601D;&#x3046;&#x306E;&#x3067;&#x3001;&#x3053;&#x3093;&#x306A;&#x30D1;&#x30C3;
&#x30C1;&#x3092;&#x3064;&#x304F;&#x3063;&#x3066;&#x307F;&#x307E;&#x3057;&#x305F;&#x3002;

&#x73FE;&#x5728;&#x306E; MHC CVS &#x306B;&#x3042;&#x305F;&#x308A;&#x307E;&#x3059;&#x3002;&#x672C;&#x5F53;&#x306F; mhc-parse/strict &#x3068;&#x3044;&#x3046;&#x5909;&#x6570;
&#x3092;&#x3082;&#x3063;&#x3068;&#x3061;&#x3083;&#x3093;&#x3068;(^^;)&#x6271;&#x3063;&#x305F;&#x65B9;&#x304C;&#x826F;&#x3044;&#x3068;&#x601D;&#x3046;&#x306E;&#x3067;&#x3059;&#x304C;&#x624B;&#x629C;&#x304D;&#x3067;&#x3059;&#x3002;

## &#x624B;&#x3092;&#x629C;&#x304D;&#x3059;&#x304E;&#x3066;&#x306A;&#x306B;&#x304B;&#x9593;&#x9055;&#x3063;&#x3066;&#x3044;&#x308B;&#x304B;&#x3082;&#x3002;&#x3042;&#x307E;&#x308A;&#x52D5;&#x4F5C;&#x78BA;&#x8A8D;&#x3057;&#x3066;&#x3044;&#x306A;
## &#x3044;&#x3057;&#x3002;

-- 
&#x767D;&#x4E95;&#x79C0;&#x884C; (<a  rel="nofollow" href="mailto:shirai@xxxxxxxxxxxxx">mailto:shirai@xxxxxxxxxxxxx</a>)
</pre><pre>Index: mhc-draft.el
===================================================================
RCS file: /cvsroot/mhc/emacs/mhc-draft.el,v
retrieving revision 1.7
diff -u -r1.7 mhc-draft.el
--- mhc-draft.el	4 May 2004 13:48:31 -0000	1.7
+++ mhc-draft.el	4 Oct 2005 06:00:30 -0000
@@ -167,7 +167,8 @@
   &quot;Add current draft as a schedule.&quot;
   (interactive)
   (let ((record
-	 (mhc-parse-buffer (mhc-record-new mhc-draft-buffer-file-name))))
+	 (mhc-parse-buffer (mhc-record-new mhc-draft-buffer-file-name)
+			   'strict)))
     (mhc-calendar-input-exit)
     (if (mhc-db-add-record-from-buffer record (current-buffer)
 				       (not (interactive-p)))
Index: mhc-parse.el
===================================================================
RCS file: /cvsroot/mhc/emacs/mhc-parse.el,v
retrieving revision 1.11
diff -u -r1.11 mhc-parse.el
--- mhc-parse.el	3 Oct 2005 14:58:02 -0000	1.11
+++ mhc-parse.el	4 Oct 2005 06:00:30 -0000
@@ -18,6 +18,7 @@
 (require 'mhc-record)
 (require 'mhc-header)
 
+(defvar mhc-parse/strict nil)
 
 (defun mhc-parse/continuous-lines ()
   &quot;&#x30D8;&#x30C3;&#x30C0;&#x306E;&#x7D99;&#x7D9A;&#x884C;&#x3092;&#x51E6;&#x7406;&#x3057;&#x3066;&#x3001;&#x5185;&#x5BB9;&#x306E;&#x307F;&#x3092;&#x53D6;&#x308A;&#x51FA;&#x3059;&#x95A2;&#x6570;&quot;
@@ -78,24 +79,26 @@
    (mhc-eword-decode-string (mhc-parse/continuous-lines)))
   schedule)
 
-(defconst mhc-parse/time-regexp &quot;\\([012][0-9]\\):\\([0-5][0-9]\\)&quot;)
+(defconst mhc-parse/time-regexp &quot;\\([012]?[0-9]\\):\\([0-5][0-9]\\)&quot;)
 
 (defun mhc-parse/time (record schedule)
-  (let ((time (mhc-parse/continuous-lines)))
-    (let (begin end)
-      (cond
-       ((string-match (concat &quot;^&quot; mhc-parse/time-regexp &quot;-&quot; mhc-parse/time-regexp &quot;$&quot;) time)
-	(setq begin (+ (* 60 (string-to-number (match-string 1 time)))
-		       (string-to-number (match-string 2 time)))
-	      end (+ (* 60 (string-to-number (match-string 3 time)))
-		     (string-to-number (match-string 4 time)))))
-       ((string-match (concat &quot;^&quot; mhc-parse/time-regexp &quot;-?$&quot;) time)
-	(setq begin (+ (* 60 (string-to-number (match-string 1 time)))
-		       (string-to-number (match-string 2 time)))))
-       ((string-match (concat &quot;^-&quot; mhc-parse/time-regexp &quot;$&quot;) time)
-	(setq end (+ (* 60 (string-to-number (match-string 1 time)))
-		     (string-to-number (match-string 2 time))))))
-      (mhc-schedule/set-time schedule begin end)))
+  (let ((time (mhc-parse/continuous-lines))
+	begin end)
+    (cond
+     ((string-match (concat &quot;^&quot; mhc-parse/time-regexp &quot;-&quot; mhc-parse/time-regexp &quot;$&quot;) time)
+      (setq begin (+ (* 60 (string-to-number (match-string 1 time)))
+		     (string-to-number (match-string 2 time)))
+	    end (+ (* 60 (string-to-number (match-string 3 time)))
+		   (string-to-number (match-string 4 time)))))
+     ((string-match (concat &quot;^&quot; mhc-parse/time-regexp &quot;-?$&quot;) time)
+      (setq begin (+ (* 60 (string-to-number (match-string 1 time)))
+		     (string-to-number (match-string 2 time)))))
+     ((string-match (concat &quot;^-&quot; mhc-parse/time-regexp &quot;$&quot;) time)
+      (setq end (+ (* 60 (string-to-number (match-string 1 time)))
+		   (string-to-number (match-string 2 time)))))
+     ((and mhc-parse/strict (not (string= &quot;&quot; time)))
+      (error &quot;Parse ERROR!!!(at X-SC-Time:)&quot;)))
+    (mhc-schedule/set-time schedule begin end))
   schedule)
 
 ;; For backward compatibility.
@@ -103,8 +106,15 @@
   (mhc-logic-parse-old-style-date (mhc-schedule-condition schedule))
   (mhc-parse/time record schedule))
 
+(defconst mhc-parse/alarm-regexp &quot;^[0-9]+ \\(minute\\|hour\\|day\\)$&quot;)
+
 (defun mhc-parse/alarm (record schedule)
-  (mhc-schedule/set-alarm schedule (mhc-parse/continuous-lines))
+  (let ((alarm (mhc-parse/continuous-lines)))
+    (unless (or (not mhc-parse/strict)
+		(string-match mhc-parse/alarm-regexp alarm)
+		(string= &quot;&quot; alarm))
+      (error &quot;Parse ERROR!!! (at X-SC-Alarm:)&quot;))
+    (mhc-schedule/set-alarm schedule alarm))
   schedule)
 
 (defun mhc-parse/category (record schedule)
@@ -165,9 +175,11 @@
 
 ;; FIXME: top level &#x3068;&#x305D;&#x308C;&#x4EE5;&#x5916;&#x306E;&#x5834;&#x6240;&#x3067;&#x8A31;&#x3055;&#x308C;&#x308B; header &#x304C;&#x7570;&#x306A;&#x308B;&#x306E;&#x3067;&#x3001;
 ;; multi pass parser &#x306B;&#x7D44;&#x307F;&#x66FF;&#x3048;&#x308B;&#x3079;&#x304D;&#x304B;&#x3082;&#x77E5;&#x308C;&#x306A;&#x3044;&#x3002;
-(defun mhc-parse/internal-parser (record &amp;optional schedule)
+(defun mhc-parse/internal-parser (record &amp;optional schedule strict)
   &quot;Internal parseser of schedule headers in this narrowed buffer.&quot;
-  (let (func (case-fold-search t))
+  (let ((mhc-parse/strict strict)
+	(case-fold-search t)
+	func)
     (while (not (eobp))
       (if (looking-at &quot;\\([^ \t:]+\\):&quot;)
 	  (progn
@@ -190,12 +202,12 @@
 	(forward-line 1))))
   schedule)
 
-(defun mhc-parse-buffer (&amp;optional record)
+(defun mhc-parse-buffer (&amp;optional record strict)
   &quot;Parse schedule headers in this buffer.&quot;
   (unless record
     (setq record (mhc-record-new (buffer-file-name))))
   (mhc-header-narrowing
-    (let ((schedule (mhc-parse/internal-parser record)))
+    (let ((schedule (mhc-parse/internal-parser record nil strict)))
       (if schedule (mhc-schedule/set-region-end schedule (point)))))
   ;; &#x5F97;&#x3089;&#x308C;&#x305F;&#x69CB;&#x9020;&#x3092;&#x6574;&#x7406;&#x3059;&#x308B;
   (let (schedules sexp)
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="02170" href="msg02170.html">[mhc:02171] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="02164" href="msg02164.html">[mhc:02165] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="02165" href="msg02165.html">[mhc:02166] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
<ul><li><em>From:</em> NOGUCHI Yusuke</li></ul></li>
<li><strong><a name="02166" href="msg02166.html">[mhc:02167] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
<ul><li><em>From:</em> &#x767D;&#x4E95;&#x79C0;&#x884C;</li></ul></li>
<li><strong><a name="02167" href="msg02167.html">[mhc:02168] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
<ul><li><em>From:</em> NOGUCHI Yusuke</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg02167.html">[mhc:02168] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg02168.html">[mhc:02169] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg02167.html">[mhc:02168] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg02170.html">[mhc:02171] Re: &#x5F62;&#x5F0F;&#x30A8;&#x30E9;&#x30FC;&#x306E;&#x30C1;&#x30A7;&#x30C3;&#x30AF;&#x306B;&#x3064;&#x3044;&#x3066;&#x8CEA;&#x554F;</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#02169"><strong>Date</strong></a></li>
<li><a href="threads.html#02169"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
