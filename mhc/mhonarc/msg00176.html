<!-- MHonArc v2.6.16 -->
<!--X-Subject: [mhc:00177] =?iso&#45;2022&#45;jp?B?GyRCPi4lTSU/GyhC?= -->
<!--X-From-R13: Kbfuvanev @A[GDO <abzNpfpr.xlhfuh&#45;h.np.wc> -->
<!--X-Date: Mon, 27 Sep 1999 19:03:55 +0900 -->
<!--X-Message-Id: 19990927190353H.nom@csce.kyushu&#45;u.ac.jp -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[mhc:00177] &#x5C0F;&#x30CD;&#x30BF;</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00175.html">Date Prev</a>][<a href="msg00177.html">Date Next</a>][<a href="msg00181.html">Thread Prev</a>][<a href="msg00182.html">Thread Next</a>][<a href="maillist.html#00176">Date Index</a>][<a href="threads.html#00176">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[mhc:00177] &#x5C0F;&#x30CD;&#x30BF;</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: [mhc:00177] &#x5C0F;&#x30CD;&#x30BF;</li>
<li><em>From</em>: Yoshinari NOMURA &lt;<a href="mailto:nom@DOMAIN.HIDDEN">nom@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 27 Sep 1999 19:03:55 +0900</li>
<li><em>Posted</em>: Mon, 27 Sep 1999 19:03:53 +0900</li>
<li><em>Reply-to</em>: <a href="mailto:mhc@DOMAIN.HIDDEN">mhc@xxxxxxxxxxxxxxxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&#x30C0;&#x30A4;&#x30A8;&#x30FC;&#x512A;&#x52DD;&#x306E;&#x3068;&#x304D;&#x306F;&#x3001;&#x798F;&#x5CA1;&#x3092;&#x96E2;&#x308C;&#x3066;&#x3044;&#x305F;&#x308A;&#x3057;&#x3066;&#x3001;&#x9593;&#x304C;&#x60AA;&#x3044;&#x4E43;&#x6751;&#x3067;&#x3059;&#x3002;
&#x5C0F;&#x30CD;&#x30BF;&#x3002;

&#x2605; My Meeting 2000

   meeting2000 &#x3063;&#x3066;&#x77E5;&#x3063;&#x3066;&#x307E;&#x3059;&#x304B;?
   ruby &#x3067;&#x66F8;&#x304B;&#x308C;&#x305F; meeting &#x306E;&#x6642;&#x9593;&#x8ABF;&#x6574;&#x30B5;&#x30FC;&#x30D0;&#x3067;&#x3059;&#x3002;

   &#x30A4;&#x30D9;&#x30F3;&#x30C8;&#x3067;&#x3068;&#x304D;&#x3069;&#x304D;&#x4F7F;&#x3046;&#x306E;&#x3067;&#x3059;&#x304C;&#x3001;
   &#x81EA;&#x5206;&#x306E;&#x4E88;&#x5B9A;&#x8868;&#x3068;&#x4ED8;&#x304D;&#x5408;&#x308F;&#x305B;&#x306A;&#x304C;&#x3089;&#x3001;&#x3053;&#x308C;&#x306B;&#x5165;&#x529B;&#x3059;&#x308B;&#x306E;&#x3063;&#x3066;&#x3001;
   &#x8996;&#x7DDA;&#x3092;&#x52D5;&#x304B;&#x3059;&#x306E;&#x304C;&#x5ACC;&#x3044;&#x306A;&#x50D5;&#x3068;&#x3057;&#x3066;&#x306F;&#x3001;&#x3059;&#x3054;&#x304F;&#x75B2;&#x308C;&#x308B;&#x3093;&#x3067;&#x3059;&#x3088;&#x306D;&#x3002;&#x3002;

   &#x305D;&#x3053;&#x3067;&#x3001;meeting200 &#x304C;&#x5410;&#x304F;&#x5165;&#x529B;&#x30D5;&#x30A9;&#x30FC;&#x30E0;&#x306B;&#x81EA;&#x5206;&#x306E;&#x4E88;&#x5B9A;&#x3092;&#x4E26;&#x3079;&#x3066;&#x898B;&#x305B;&#x308B;
   &#x30D7;&#x30ED;&#x30AD;&#x30B7;&#x3092;&#x3067;&#x3063;&#x3061;&#x3042;&#x3052;&#x3066;&#x307F;&#x307E;&#x3057;&#x305F;&#x3002;&#x4EE5;&#x4E0B; Navigator &#x3067;&#x306E;&#x8A2D;&#x5B9A;&#x3002;

   ## &#x57FA;&#x672C;&#x7684;&#x306B;&#x8CB0;&#x3063;&#x3066;&#x304D;&#x305F; html &#x306B;&#x4EFB;&#x610F;&#x306E; Filter &#x3092;&#x901A;&#x3059; proxy &#x306A;&#x306E;
   ## &#x3067;&#x3001;&#x7279;&#x5B9A;&#x306E;&#x5358;&#x8A9E;&#x3092;&#x4F0F;&#x305B;&#x5B57;&#x306B;&#x3059;&#x308B;&#x3088;&#x3046;&#x306A;&#x4F7F;&#x7528;&#x3082;&#x8003;&#x3048;&#x3089;&#x308C;&#x307E;&#x3059;&#x306D;&#x3002;

   &#x3042;&#x3001;&#x305D;&#x308C;&#x3068;&#x4E00;&#x5207;&#x8A8D;&#x8A3C;&#x3057;&#x3066;&#x306A;&#x3044;&#x306E;&#x3067;&#x3001;&#x4ED6;&#x4EBA;&#x304B;&#x3089;&#x3064;&#x306A;&#x304C;&#x308C;&#x308B;&#x3068;&#x30B9;&#x30B1;&#x30B8;&#x30E5;&#x30FC;
   &#x30EB;&#x4E38;&#x898B;&#x3048;&#x3067;&#x3059;&#x3002;:-)

   1. &#x9069;&#x5F53;&#x306A; proxy.pac &#x3092;&#x66F8;&#x3044;&#x3066;&#x3001;&#x3053;&#x308C;&#x3092; Navigator &#x306E; proxy &#x8A2D;&#x5B9A;
      &#x306B;&#x6307;&#x5B9A;&#x3057;&#x307E;&#x3059;&#x3002;file:/home/nom/proxy.pac &#x3068;&#x3067;&#x3082;&#x3002;

    function FindProxyForURL(url, host)
    {
	// &#x4F8B;&#x3048;&#x3070;&#x3001;meeting2000.hoge.hoge.com:8080 &#x306E;&#x3068;&#x304D;&#x306F; 
	// localhost:33333 &#x3067;&#x52D5;&#x3044;&#x3066;&#x3044;&#x308B; My meeting 2000 Proxy &#x3092;&#x901A;&#x3059;&#x3002;
        if (dnsDomainIs(host, &quot;meeting2000.hoge.hoge.com&quot;) &amp;&amp; 
            shExpMatch(url, &quot;*meeting2000.hoge.hoge.com:8080*&quot;))
            return &quot;PROXY localhost:33333; DIRECT&quot;

	// &#x3053;&#x3053;&#x304B;&#x3089;&#x306F;&#x666E;&#x6BB5;&#x4F7F;&#x3063;&#x3066;&#x3044;&#x308B; Proxy &#x304C;&#x3042;&#x308C;&#x3070;&#x3001;&#x305D;&#x308C;&#x7528;&#x306E;&#x8A2D;&#x5B9A;
	// &#x306B;&#x3057;&#x3066;&#x304A;&#x304F;&#x3002;&#x3053;&#x306E;&#x4F8B;&#x3067;&#x306F;&#x3001;&#x666E;&#x6BB5;&#x306E; Proxy &#x306A;&#x3057;&#x3002;
        return &quot;DIRECT&quot;;
    }

    2. &#x4EE5;&#x4E0B;&#x306E; script &#x3092; localhost &#x3067;&#x52D5;&#x304B;&#x3059;&#x3002;

#!/usr/local/bin/ruby

require 'socket'
require 'mhc-schedule'
require 'kconv'
Thread .abort_on_exception = true
$DEBUG = false

$mhc_db = MhcScheduleDB .new
wSock = TCPserver .open(33333)
addr = wSock .addr
addr .shift
printf(&quot;server is on %d\n&quot;, addr .join(&quot;:&quot;)) if $DEBUG

def proxy(cSock)
  sSock  = nil
  th1    = nil
  filter = false

  th2 = Thread .start {
    Thread .stop if !sSock
    while line = sSock .gets
      print &quot;S&gt; #{line}&quot;  if $DEBUG
      if line =~ /Content-Length:/i
	next
      end
      if line =~ /Server:\s*Meeting2000/
	filter = true
      end
      if filter
	begin
	  cSock .write(filter_proc(line))
	rescue
	end
      else
	begin
	  cSock .write(line)
	rescue
	end
      end
    end
    th1 .exit
    cSock .close
  }

  th1 = Thread .start {
    buf   = ''
    while line = cSock .gets
      print &quot;C&gt; #{line}&quot;  if $DEBUG
      if line =~ /^(get|post)\s*http:\/\/(.*)\s*(HTTP.*)/i
	command     = $1
	http_ver    = $3
	host, trail = $2 .split('/', 2)
	host, port  = host .split(':', 2)
	trail       = '/' + trail
	port = 80 if !port
	print &quot;sSock =&gt; open(#{host}, #{port})\n&quot;  if $DEBUG
	sSock = TCPSocket .open(host, port)
	line = &quot;#{command} #{trail} #{http_ver}\r\n&quot;
	th2 .run
      end

      buf += line
      if sSock
	if buf =~ /^get/i
	  print &quot;&gt; #{buf}&quot;  if $DEBUG
	end
	begin
	  sSock .write(buf)
	rescue
	end
	buf = ''
      end
    end
    th2 .exit
    sSock .close
  }
end

W_TO_COLOR = ['red', nil, nil, nil, nil, nil, 'blue']

def c_str(c, *arg)
  if c .is_a?(String)
    color = c
  elsif c .is_a?(Integer)
    color = W_TO_COLOR[c]
  else
    color = nil
  end
  if color
    return &quot;&lt;font color=#{color}&gt;&quot; +  arg .join + &quot;&lt;/font&gt;&quot;
  else
    return arg .join
  end
end

def filter_proc(line)
  ret = ''
  if line =~ /type\s*=\s*checkbox.*(\d{4})-(\d\d)-(\d\d)-check/i
    date = MhcDate .new($1 .to_i, $2 .to_i, $3 .to_i)
    ret += c_str(date .w, line)

    $mhc_db .search1(date) .each{|sch|
      if sch .in_category?('Holiday')
	c = 'red'
      else
	c = 'green'
      end
      ret += c_str(c, Kconv::toeuc(&quot;&lt;dd&gt;#{sch .time_as_string} #{sch .subject}&lt;/dd&gt;&quot;))
    }
  else
    ret = line
  end
  return ret
end

while true
  s = wSock .accept
  print s, &quot; is accepted\n&quot;  if $DEBUG
  proxy(s)
end

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00175.html">[mhc:00176] Re: font-lock for MHC</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00177.html">[mhc:00178] Re: &#x5C0F;&#x30CD;&#x30BF;</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00181.html">[mhc:00182] Re: font-lock for MHC</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00182.html">[mhc:00183] mhc does not work</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00176"><strong>Date</strong></a></li>
<li><a href="threads.html#00176"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
